#!/bin/bash

# Test script for POD install

if [ ! -e ~/pod ]; then 
  echo "No sym link to the pod root directory"
  echo "In you home dorectory create a sym link to the pod root directory"
  echo "Eg: cd ~; ln -s /data/software/acs/pod pod"
  exit
fi

# Clean up old files
./ex2.clean
 
# Create necessary links
ln -s ~/pod/tables/ascp1950.430 .             >& /dev/null
ln -s ~/pod/tables/fes2004_Cnm-Snm.dat .      >& /dev/null
ln -s ~/pod/tables/goco05s.gfc .              >& /dev/null
ln -s ~/pod/tables/header.430_229 .           >& /dev/null
ln -s ~/pod/tables/igs_metadata_2063.snx .    >& /dev/null
ln -s ~/pod/tables/leap.second .              >& /dev/null
ln -s ~/pod/tables/eopc04_14_IAU2000.62-now . >& /dev/null

# Run the POD
~/pod/bin/pod | tee pod.out

echo 'Plotting: 1] orbit fit residual time series'
python3 ~/pod/scripts/res_plot.py     -i gag20624__orbdiff_rtn.out -d . -c C >& /dev/null
python3 ~/pod/scripts/res_plot.py     -i gag20624__orbdiff_rtn.out -d . -c E >& /dev/null
python3 ~/pod/scripts/res_plot.py     -i gag20624__orbdiff_rtn.out -d . -c G >& /dev/null
python3 ~/pod/scripts/res_plot.py     -i gag20624__orbdiff_rtn.out -d . -c R >& /dev/null
echo '          2] orbit fit statistics'
python3 ~/pod/scripts/rms_bar_plot.py -i gag20624__orbdiff_rtn.out -d . -c C >& pod_C.rms
python3 ~/pod/scripts/rms_bar_plot.py -i gag20624__orbdiff_rtn.out -d . -c E >& pod_E.rms
python3 ~/pod/scripts/rms_bar_plot.py -i gag20624__orbdiff_rtn.out -d . -c G >& pod_G.rms
python3 ~/pod/scripts/rms_bar_plot.py -i gag20624__orbdiff_rtn.out -d . -c R >& pod_R.rms

# Diff output
diff pod.out ./solution/pod.out
diff pod_G.rms ./solution/pod_G.rms
diff gag20624.sp3 ./solution/gag20624.sp3

# Cleanup 
\rm -r EQM0* VEQ0* ECOM1_*.in ECOM2_*.in emp*.in DE.430 

exit 
